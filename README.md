# ShikiPlayer

ShikiPlayer — это пользовательский скрипт, который встраивает видеоплеер непосредственно на сайт Shikimori, позволяя смотреть аниме прямо на странице без необходимости покидать платформу. Поддерживает несколько источников видео (Turbo, Lumex, Alloha, Kodik) с автоматическим переключением на резервный источник в случае сбоя и выпадающим меню для ручного выбора.

- [Возможности](#возможности)
- [Установка](#установка)
- [Использование](#использование)
- [Скриншот](#скриншот)
- [Поддерживаемые плееры](#поддерживаемые-плееры)
- [Требования](#требования)
- [Совместимость](#совместимость)
- [Разработка](#разработка)
- [Устранение неполадок](#устранение-неполадок)
- [Автор](#автор)
- [Лицензия](#лицензия)

## Возможности
- **Встроенный видеоплеер**: Смотрите аниме прямо на страницах Shikimori.
- **Несколько источников**: Поддержка плееров Turbo, Lumex, Alloha и Kodik с автоматическим переключением при сбое.
- **Отслеживание эпизодов**: Автоматическое определение следующего эпизода на основе вашей статистики на Shikimori.
- **Ленивая загрузка**: Плеер загружается только при появлении в видимой области экрана для оптимизации производительности.
- **Уведомления**: Современные стилизованные уведомления для отображения ошибок, предупреждений и информации.
- **Адаптивный дизайн**: Адаптируется к разным размерам экрана для удобного использования.
- **Кэширование**: Сохраняет ответы API для уменьшения количества запросов и ускорения загрузки.
- **Динамическая обработка URL**: Автоматически обновляет плеер при навигации по страницам Shikimori.

## Установка
1. Установите менеджер пользовательских скриптов, например, [Tampermonkey](https://www.tampermonkey.net/) или [Greasemonkey](https://www.greasespot.net/).
2. Нажмите [здесь](https://github.com/Onzis/ShikiPlayer/raw/refs/heads/main/ShikiPlayer.user.js), чтобы установить скрипт.
3. Перейдите на любую страницу аниме на [Shikimori](https://shikimori.one/) (например, `https://shikimori.one/animes/1234-anime-name`).

## Использование
- Плеер автоматически встраивается на страницы аниме Shikimori.
- Используйте выпадающее меню в заголовке плеера, чтобы переключаться между Turbo, Lumex, Alloha или Kodik.
- Если плеер не загружается, скрипт автоматически пробует следующий доступный источник и показывает уведомление.
- Уведомления появляются внизу экрана и автоматически исчезают через несколько секунд, либо их можно закрыть вручную.

## Скриншот
![ShikiPlayer в действии](Onzis/ShikiPlayer/public/player.png)

## Поддерживаемые плееры
1. **Turbo**: Быстрый и легкий, используется по умолчанию.
2. **Lumex**: Альтернативный плеер с поддержкой эпизодов.
3. **Alloha**: Высококачественная трансляция, требует поддержки кодеков браузером (H.264 или VP9).
4. **Kodik**: Надежный резервный вариант.

## Требования
- Современный браузер с поддержкой `IntersectionObserver` и `MutationObserver`.
- Для Alloha браузер должен поддерживать кодеки H.264 (`avc1.42E01E, mp4a.40.2`) или VP9 (`vp9, vorbis`).
- Установленный менеджер пользовательских скриптов (например, Tampermonkey или Greasemonkey).

## Совместимость
- Работает на страницах аниме [Shikimori](https://shikimori.one/) (`/animes/*`).
- Поддерживает динамическую навигацию (Turbolinks и history API).
- Протестировано в Chrome, Firefox и Edge с Tampermonkey.

## Разработка
- **Исходный код**: Доступен на [GitHub](https://github.com/Onzis/ShikiPlayer).
- **Лицензия**: GPL-3.0.
- **Участие**: Приглашаем сообщать об ошибках или предлагать улучшения через GitHub.
- **Зависимости**: Использует `GM.xmlHttpRequest` для API-запросов, предоставляемый менеджером пользовательских скриптов.

## Устранение неполадок
- **Плеер не загружается?** Убедитесь, что ваш браузер поддерживает необходимые кодеки для Alloha. Попробуйте переключиться на другой плеер через выпадающее меню.
- **Видео не найдено?** Возможно, аниме недоступно на поддерживаемых источниках. Проверьте уведомление для подробностей.
- **Скрипт не работает?** Убедитесь, что менеджер пользовательских скриптов включен, а скрипт обновлен до последней версии.
- **Проблемы сохраняются?** Создайте issue на [GitHub](https://github.com/Onzis/ShikiPlayer/issues) с описанием проблемы.

## Автор
- **Автор**: Onzis
- **Домашняя страница**: [https://github.com/Onzis/ShikiPlayer](https://github.com/Onzis/ShikiPlayer)
- **Используемые API**:
  - Shikimori API (`shikimori.one`)
  - Kodik API (`kodikapi.com`)
  - Alloha API (`api.alloha.tv`)
  - Kinobox API (`api.kinobox.tv`)

## Лицензия
Проект распространяется под лицензией GPL-3.0. Подробности смотрите в файле [LICENSE](https://github.com/Onzis/ShikiPlayer/blob/main/LICENSE).